{"version":3,"sources":["ts/dto/Customer.ts","ts/manage-customers.ts"],"names":[],"mappings":"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","file":"manage-customers.113d91fd.js","sourceRoot":"..","sourcesContent":["export class Customer {\n    constructor(\n        public id: string, \n        public name: string,\n        public address: string){}\n}","import { Customer } from \"./dto/Customer\";\n\nconst BASE_API = 'https://6c20934f-3597-4e3a-a6b8-bb3340352c7a.mock.pstmn.io';\n// const BASE_API = 'http://localhost:8080/pos';\nconst CUSTOMERS_SERVICE_API = `${BASE_API}/customers`;\nconst PAGE_SIZE = 6;\n\nlet customers: Array<Customer> = [];\nlet totalCustomers = 0;\nlet selectedPage = 1;\nlet pageCount = 1;\n\nloadAllCustomers();\n/*  */\n\n/* load customer part */\nfunction loadAllCustomers(): void {\n\n    const http = new XMLHttpRequest();\n\n    http.onreadystatechange = () => {\n\n        if (http.readyState === http.DONE) {\n\n            if (http.status !== 200) {\n                alert(\"Failed to fetch customers, try again...!\");\n                return;\n            }\n\n            totalCustomers = +(http.getResponseHeader('X-Total-Count'));\n            customers = JSON.parse(http.responseText);\n\n            $('#tbl-customers tbody tr').remove();\n\n            customers.forEach((c) => {\n                const rowHtml = `<tr>\n                 <td>${c.id}</td>\n                 <td>${c.name}</td>\n                 <td>${c.address}</td>\n                 <td><i class=\"fas fa-trash trash\"></i></td>\n                 </tr>` ;\n\n\n                $('#tbl-customers tbody').append(rowHtml);\n            });\n\n            initPagination();\n\n        }\n\n    };\n\n    // http://url?page=10&size=10\n    http.open('GET', CUSTOMERS_SERVICE_API + `?page=${selectedPage}&size=${PAGE_SIZE}`, true);\n\n    // 4. Setting headers, etc.\n\n    http.send();\n\n}\n\nfunction initPagination(): void {\n\n    pageCount = Math.ceil(totalCustomers / PAGE_SIZE);\n\n    showOrHidePagination();\n    if (pageCount === 1) return;\n\n    let html = `<li class=\"page-item\"><a class=\"page-link\" href=\"#!\">«</a></li>`;\n\n    for (let i = 0; i < pageCount; i++) {\n        html += `<li class=\"page-item ${selectedPage === (i + 1) ? 'active' : ''}\"><a class=\"page-link\" href=\"javascript:void(0);\">${i + 1}</a></li>`;\n    }\n\n    html += `<li class=\"page-item\"><a class=\"page-link\" href=\"javascript:void(0);\">»</a></li>`;\n\n    $(\"ul.pagination\").html(html);\n\n    if (selectedPage === 1) {\n        $(\".page-item:first-child\").addClass('disabled');\n    } else if (selectedPage === pageCount) {\n        $(\".page-item:last-child\").addClass('disabled');\n    }\n\n    $(\".page-item:first-child\").on('click', () => navigateToPage(selectedPage - 1));\n    $(\".page-item:last-child\").on('click', () => navigateToPage(selectedPage + 1));\n\n    $(\".page-item:not(.page-item:first-child, .page-item:last-child)\").on('click', function () {\n        navigateToPage(+$(this).text());\n    });\n\n}\n\nfunction navigateToPage(page: number): void {\n\n    if (page < 1 || page > pageCount) return;\n\n    selectedPage = page;\n    loadAllCustomers();\n\n}\n/* Pagination part */\nfunction showOrHidePagination(): void {\n    pageCount > 1 ? $(\".pagination\").show() : $('.pagination').hide();\n}\n\n$('#btn-save').on('click', (eventData) => {\n    eventData.preventDefault();\n\n    const txtId = $('#txt-id');\n    const txtName = $('#txt-name');\n    const txtAddress = $('#txt-address');\n\n    let id = (txtId.val() as string).trim();\n    let name = (txtName.val() as string).trim();\n    let address = (txtAddress.val() as string).trim();\n\n    let validated = true;\n    $('#txt-id, #txt-name, #txt-address').removeClass('is-invalid');\n\n    if (address.length < 3) {\n        txtAddress.addClass('is-invalid');\n        txtAddress.trigger('select');\n        validated = false;\n    }\n\n    if (!/^[A-Za-z ]+$/.test(name)) {\n        txtName.addClass('is-invalid');\n        txtName.trigger('select');\n        validated = false;\n    }\n\n    if (!/^C\\d{3}$/.test(id)) {\n        txtId.addClass('is-invalid');\n        txtId.trigger('select');\n        validated = false;\n    }\n\n    if (!validated) return;\n\n    if (txtId.attr('disabled')) {\n\n        const selectedRow = $(\"#tbl-customers tbody tr.selected\");\n        updateCustomer(new Customer(id, name, address));\n        return;\n    }\n\n\n    saveCustomer(new Customer(id, name, address));\n});\n\nfunction saveCustomer(customer: Customer): void {\n    const http = new XMLHttpRequest();\n\n    http.onreadystatechange = () => {\n\n        if (http.readyState !== http.DONE) return;\n\n        if (http.status !== 201) {\n            console.error(http.responseText);\n            alert(\"Failed to save the customer, retry\");\n            return;\n        }\n\n        alert(\"Customer has been saved successfully\");\n\n        totalCustomers++;\n        pageCount = Math.ceil(totalCustomers / PAGE_SIZE);\n\n        navigateToPage(pageCount);\n        $('#txt-id, #txt-name, #txt-address').val('');\n        $('#txt-id').trigger('focus');\n    };\n\n    http.open('POST', CUSTOMERS_SERVICE_API, true);\n\n    http.setRequestHeader('Content-Type', 'application/json');\n\n    http.send(JSON.stringify(customer));\n}\n\n$('#tbl-customers tbody').on('click', 'tr', function () {\n\n    const id = $(this).find(\"td:first-child\").text();\n    const name = $(this).find(\"td:nth-child(2)\").text();\n    const address = $(this).find(\"td:nth-child(3)\").text();\n\n    $('#txt-id').val(id).attr('disabled', \"true\");\n    $('#txt-name').val(name);\n    $('#txt-address').val(address);\n\n    $(\"#tbl-customers tbody tr\").removeClass('selected');\n    $(this).addClass('selected');\n\n});\n\n/* Update part */\nfunction updateCustomer(customer: Customer): void {\n    const http = new XMLHttpRequest();\n\n    http.onreadystatechange = () => {\n\n        if (http.readyState !== http.DONE) return;\n\n        if (http.status !== 204) {\n            alert(\"Failed to update the customer, retry\");\n            return;\n        }\n\n        alert(\"Customer has been updated successfully\");\n        // $(\"#tbl-customers tbody tr.selected\").find(\"td:nth-child(2)\").text($(\"#txt-name\").val());\n        // $(\"#tbl-customers tbody tr.selected\").find(\"td:nth-child(3)\").text($(\"#txt-address\").val());\n        $('#txt-id, #txt-name, #txt-address').val('');\n        $('#txt-id').trigger('focus');\n        $(\"#tbl-customers tbody tr.selected\").removeClass('selected');\n        $('#txt-id').removeAttr('disabled');\n\n    };\n\n    http.open('PUT', CUSTOMERS_SERVICE_API, true);\n\n    http.setRequestHeader('Content-Type', 'application/json');\n\n    http.send(JSON.stringify(customer));\n\n}\n\n/* Delete part */\n$('#tbl-customers tbody').on('click', '.trash', function (eventData) {\n    if (confirm('Are you sure to delete?')) {\n        deleteCustomer(($(eventData.target).parents(\"tr\").find('td:first-child')).text());\n    }\n});\n\nfunction deleteCustomer(id: string): void {\n    const http = new XMLHttpRequest();\n\n    http.onreadystatechange = () => {\n\n        if (http.readyState === http.DONE) {\n\n            if (http.status !== 204) {\n                alert(\"Failed to delete customer, try again...!\");\n                return;\n            }\n\n            totalCustomers--;\n            pageCount = Math.ceil(totalCustomers / PAGE_SIZE);            \n            navigateToPage(pageCount);\n\n        }\n\n    };\n\n    http.open('DELETE', CUSTOMERS_SERVICE_API + `?id=${id}`, true);\n\n    http.send();\n}\n\n\n/* Clear button */\n$('#btn-clear').on('click', () => {\n    $(\"#tbl-customers tbody tr.selected\").removeClass('selected');\n    $(\"#txt-id\").removeAttr('disabled').trigger('focus');\n});"]}